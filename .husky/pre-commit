#!/bin/sh

# Husky pre-commit hook

# è¿è¡Œæ ¼å¼åŒ–æ£€æŸ¥
if command -v swiftformat >/dev/null 2>&1; then
  echo "ğŸ§¹ Running SwiftFormat..."
  if ! swiftformat --config .swiftformat . --lint; then
    echo "âŒ SwiftFormat lint failed"
    exit 1
  fi
  git add -u
fi

# è¿è¡Œæ„å»ºæ£€æŸ¥
echo "ğŸ— Running swift build..."
if ! swift build --quiet; then
  echo "â›”ï¸ Build failed"
  exit 1
fi

# æ£€æµ‹GitHubä»¤ç‰Œæ³„æ¼
if git diff --cached -G'ghp_[A-Za-z0-9]{36}' | grep -q 'ghp_'; then
  echo "âŒ Detected GitHub token in staged diff. Commit aborted."
  exit 1
fi

# æˆåŠŸé€šè¿‡æ‰€æœ‰æ£€æŸ¥
echo "âœ… All pre-commit checks passed"
exit 0

# Run SwiftFormat linting
swiftformat . --lint || exit 1

# Run YAML linting
yamllint .cursorscratchpad || exit 1

# Run Swift build
swift build --quiet || exit 1 