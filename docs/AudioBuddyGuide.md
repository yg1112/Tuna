# AudioBuddy功能指南

## 功能概述

AudioBuddy是Tuna应用的一个核心功能，允许用户通过全局快捷键快速调用语音转写和音频设备管理功能。该功能通过SwiftUI实现，支持macOS平台，提供了直观的用户界面和强大的后台处理能力。

## 主要功能

1. **全局快捷键触发**：无需切换应用，在任何程序中使用快捷键即可调用转写功能
2. **音频设备管理**：查看和切换系统音频输入/输出设备
3. **语音转写**：整合Whisper API，提供高质量语音转文本功能
4. **窗口管理**：智能窗口显示和隐藏，不干扰用户工作流程

## 使用方法

### 快捷键设置

1. 打开Tuna应用设置
2. 导航到"快捷键"选项卡
3. 为"快速听写"功能设置所需快捷键
4. 保存设置

### 使用语音转写

1. 在任何应用中按下设置的快捷键
2. AudioBuddy窗口将会显示
3. 开始说话，系统会自动录制您的语音
4. 点击"停止"按钮结束录制
5. 转写结果会显示在窗口中，并可选择性自动复制到剪贴板

### 音频设备管理

1. 在AudioBuddy窗口中，可查看当前音频输入设备
2. 使用下拉菜单切换不同的音频输入设备
3. 实时监测音频输入状态和音量

## 技术实现

AudioBuddy功能由以下主要组件构成：

1. **AudioBuddyApp**：SwiftUI应用入口，负责设置主窗口和应用生命周期
2. **AppDelegate**：处理应用初始化、快捷键注册和窗口管理
3. **AudioDevice**：管理系统音频设备的访问和控制
4. **DictationManager**：处理语音录制、API调用和转写结果处理
5. **KeyboardShortcutManager**：全局快捷键管理和事件响应
6. **TabRouter**：应用内导航和状态管理

## 开发指南

### 添加新功能

如需扩展AudioBuddy功能，可以考虑以下方向：

1. 添加更多音频处理选项（如降噪、音量调节）
2. 扩展转写功能（支持更多语言、自定义词汇）
3. 增强UI交互体验

### 代码示例

快捷键注册示例：

```swift
func registerGlobalShortcut() {
    keyboardShortcutManager.registerGlobalShortcut(
        key: settings.dictationShortcutKey,
        modifiers: settings.dictationShortcutModifiers,
        action: { [weak self] in
            self?.showDictationWindow()
        }
    )
}
```

### 注意事项

1. 使用AudioBuddy功能需要麦克风访问权限
2. 语音转写功能需要网络连接和有效的API密钥
3. 全局快捷键可能与其他应用冲突，请选择不常用的组合

## 故障排除

| 问题 | 可能原因 | 解决方法 |
|------|---------|---------|
| 快捷键不响应 | 快捷键冲突或权限问题 | 更换快捷键组合或重新启动应用 |
| 无法录制音频 | 麦克风权限未授予 | 在系统偏好设置中允许麦克风访问 |
| 转写结果不准确 | 环境噪音或麦克风质量 | 使用更好的麦克风或在安静环境中使用 |
| 应用窗口不显示 | 窗口管理问题 | 强制退出并重启应用 |

## 未来规划

1. 支持更多语音转写模型
2. 添加音频前处理功能
3. 增加更多自定义选项
4. 改进转写准确性和速度

---

*最后更新：2023年4月18日* 